# 面试问题
## TCP
- TCP怎么保证可靠性（面向字节流，超时重传，应答机制，滑动窗口，拥塞控制，校验等）？
- TCP为什么可靠（腾讯，小米，头条）
- TCP 建立连接和断开连接的过程？如果 server 没有 accept，连接会怎样？
- 讲一下tcp关闭连接的过程
- http协议与TCP联系
- 建立TCP服务器的各个系统调用
- TCP（UDP，IP）等首部的认识（http请求报文构成）

### TCP为什么可靠，怎么保证可靠
tcp所有特性基本上核心都是为了可靠传输这个目标来服务的，然后有一些是出于优化性能的目的。  

- [简单聊聊TCP的可靠性](https://zhuanlan.zhihu.com/p/86391759)

### http协议与TCP联系
- [TCP/IP 和 HTTP 的区别和联系是什么？](https://www.zhihu.com/question/38648948)
- [TCP,IP,HTTP,SOCKET区别和联系](https://www.cnblogs.com/duhuo/p/4446731.html)


### 建立TCP服务器的各个系统调用
- [了解 TCP 系统调用序列](https://www.ibm.com/developerworks/cn/aix/library/au-tcpsystemcalls/index.html)

## UDP
- udp如何实现不乱序
- udp如何实现不丢包
- UDP怎么实现可靠传输
- UDP bind 和 connect 有什么用？

### 为什么DNS使用UDP而不是TCP？
- [为什么DNS使用UDP而不是TCP？](https://www.zhihu.com/question/310145373)

### 既然IP协议也能够进行数据的无连接不可靠传输服务，为什么还需要UDP协议？
- [既然IP协议也能够进行数据的无连接不可靠传输服务，为什么还需要UDP协议？](https://www.zhihu.com/question/39319676)

### UDP怎么实现可靠传输
- [UDP如何实现可靠传输？](https://www.zhihu.com/question/283995548)
- [如何实现可靠UDP传输](https://zhuanlan.zhihu.com/p/129218784)

### UDP bind 和 connect 有什么用？
- [udp通讯中的connect()和bind()函数](https://blog.csdn.net/qq_29344757/article/details/71616748)
- [告知你不为人知的UDP-连接性和负载均衡](https://zhuanlan.zhihu.com/p/25673485)
- [UDP中使用bind和connect的作用](https://www.cnblogs.com/kex1n/p/8342416.html)

## 请分别说明HTTP、TCP、IP三层协议中，接收端如何判断已接受完对端发送来的数据？
- HTTP协议的服务端响应报文里有Content-Length字段，明确了报文的长度。客户端应该是通过这个来判断的。

- TCP协议里接收方要回传确认号。如果双方各自向对方请求下一个数据包，却没有响应对方的请求，那么说明数据传完了。有时数据发送方如果发送完毕，会发出中断连接请求。对方也就知道已经发送完毕了。

- IP协议是无连接协议，不会考虑对方是否“发送完毕”。如果IP数据报被分片发送，那么只有最后一个分片的“还有分片（MF）”flag置为0，之前的分片相应flag都置为1。

## tcp、udp比较
- UDP 和 TCP 的区别？分别适用什么场景？
- TCP和UDP相关的协议与端口号
- TCP和UDP区别，TCP如何保证可靠性，对方是否存活(心跳检测)
- TCP和UDP的区别，TCP如何保证可靠性，UDP又有什么优势
- 如果想要tcp的功能，又想要用udp的速度怎么做
- DNS解析的过程，DNS是基于TCP还是UDP
- 打洞听说过吗？打洞是用什么协议实现的呢？UDP还是TCP？有哪些使用UDP和TCP的协议呢？

### TCP与UDP的区别
#### 传输控制协议 TCP（Transmission Control Protocol）
TCP是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是点对点的（一对一）。  

**特点**  
- TCP是面向连接的传输层协议
- 每一条TCP连接只能有两个端点，每一条TCP连接只能是点对点的（一对一）
- TCP提供可靠的交付服务，保证传送的数据无差错、不丢失、不重复且有序
- TCP提供全双工通信，TCP允许通信双方的应用进程在任何时候都能发送数据，为此TCP连接的梁端端都设有发送缓存和接收缓存，用来临时存放双向通信的数据
- TCP是面向字节流的，虽然应用程序和TCP的交互是一次一个数据块（大小不等），但TCP把应用程序交下来的数据看成仅仅是一连串的无结构的字节流  

#### 用户数据报协议 UDP（User Datagram Protocol）
是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。   

**特点**  
- UDP无需建立连接。因此UDP不会引入建立连接的时延。试想如果DNS运行在TCP之上而不是UDP，则DNS的速度会慢很多。HTTP使用TCP而不是UDP，是因为对于基于文本数据的Web网页来说，可靠性是至关重要的
- 无连接状态。TCP需要在端系统中维护连接状态。此链接状态包括接收和发送缓存、拥塞控制参数和序号与确认号的参数。而UDP不维护连接状态，也不跟踪这些参数。因此，某些专有应用服务器使用UDP时，一般都能支持更多的活动客户机
- 分组首部开销小。TCP有20个字节的首部开销，而UDP只有8字节的开销
- 应用层能更好的控制要发送的数据和发送时间。UDP没有拥塞控制，因此网络中的拥塞不会影响主机的发送效率。某些实时应用要求以稳定的速度发送，能容忍一些数据的丢失，但不允许有较大的时延，而UDP正好满足这些应用的需求
- UDP长用于一次性传输比较少量数据的网络应用，如DNS、SNMP等，因为对于这些应用，若采用TCP，则将为连接创建、维护和拆除带来不小的开销。UDP也常用于多媒体（如IP电话、实时视频会议、流媒体等），显然，可靠数据传输对于这些应用来说并不是最重要的，但TCP的拥塞控制会导致数据出现较大的延迟，这是它们不能容忍的
- UDP提供尽最大努力的交付，即不保证可靠交付，但这并不意味着应用对数据的要求是不可靠的，因此所有维护传输可靠性的工作需要用户在应用层来完成。应用实体可以根据应用的需求来灵活设计自己的可靠性机制
- UDP是面向报文的。发送方UDP对应从层交下来的报文，在添加首部后就向下交付给IP层，既不合并，也不拆分，而是保留这些报文的边界；接收方UDP对IP层交上来的UDP用户数据包，在去除首部后就原封不动地交付给上层应用进程，一次交付一个完整的报文。因此报文不可分割，是UDP数据报处理的最小单位


### 现在面试的视频用的是tcp还是udp，为什么？
- [QQ 为什么以 UDP 协议为主，以 TCP 协议为辅？](https://www.zhihu.com/question/20292749)
- [微信使用的是TCP还是UDP？](https://www.zhihu.com/question/35218543/answer/79054758)

## 三次握手、四次挥手
- TCP的三次握手与四次挥手的详细介绍（TCP连接建立与断开是热门问题）
- TCP握手以及每一次握手客户端和服务器端处于哪个状态（11种状态）
- 为什么使用三次握手，两次握手可不可以？
- TCP三次握手和四次挥手的各种状态（谁都问）

- TCP三次握手四次挥手
- TCP三次握手四次挥手状态图，对应的POSIX API，为什么要三次握手，两次可以吗？
- TCP三次握手的过程，为什么三次握手
- 三次握手，为什么三次
- TCP/IP的三次握手、四次挥手，为什么要用三次握手，两次可不可以，四次挥手有没有可能改成三次挥手
- 三次握手之间可能存在什么攻击（DDos攻击）
- 三次握手和四次挥手的过程，交换了哪些信息，序列号为什么是随机初始化的
- TCP和UDP有什么区别？应用场景？三次握手四次断开的过程？TCP和保证可靠性？UDP有可靠性保证吗？四次断开如果服务器没有收到客户端的确认包，会一直等待吗？等多久？
- TCP三次握手、四次挥手，如何实现可靠性，拥塞控制，数据包发生乱序如何恢复
- TCP、UDP的区别，为啥三次握手、四次挥手？

### TCP为什么需要第三次握手？第三次握手失败了会怎么样？
- 两次握手是最基本的，一般情况下能保证tcp连接正常进行。
- 需要第三次握手是为了防止已失效的请求报文段突然又传送到了服务端而产生连接的误判。  

假如没有第三次握手，服务端接收到失效的请求报文段就会认为连接已建立，从而进入等待客户端发送数据的状态。但客户端并没有发出请求，所以不会发送数据。于是服务端就会一直处于等待状态，从而浪费资源。  

第三次握手失败后：  
- 在第二次握手，服务器端向客户端发送SYN+ACK报文后，就会启动一个定时器，等待客户端返回的ACK报文。
- 如果第三次握手失败的话，客户端给服务端返回了ACK报文，服务端并不能收到这个ACK报文。那么服务端就会启动超时重传机制，超过规定时间后重新发起第二次握手，向客户端发送SYN+ACK。重传次数根据/proc/sys/net/ipv4/tcp_synack_retries来指定，默认是5次。
- 如果重传指定次数到了后，仍然未收到ACK应答，那么一段时间后，服务端会自动关闭这个连接。但客户端认为这个连接已经建立，如果客户端向服务端写数据，服务端将回应RST包、强制关闭TCP连接，以防止SYN攻击。

- [TCP为什么需要第三次握手？第三次握手失败了会怎么样？](https://www.nowcoder.com/questionTerminal/d88f9db98e034c158b51bf362dff91e3?orderByHotValue=1&page=4&onlyReference=false)
- [在tcp连接的三次握手 丢包？](https://www.zhihu.com/question/49324380)

### TCP 为什么是三次握手，而不是两次或四次？
- [TCP 为什么是三次握手，而不是两次或四次？](https://mp.weixin.qq.com/s/NIjxgx4NPn7FC4PfkHBAAQ)
- [TCP 为什么是三次握手，而不是两次或四次？ - HioHio的回答 - 知乎](https://www.zhihu.com/question/24853633/answer/573627478)

### 为什么建立连接是三次握手，而关闭连接却是四次挥手呢？
这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，己方是否现在关闭发送数据通道，需要上层应用来决定，因此，己方ACK和FIN一般都会分开发送。  

收到主动方发来的FIN报，被动方会立刻回答主动方，让主动方进入FIN-WAIT-1状态。防止主动方重复的发FIN报。    

接收到FIN报文的一方只能回复一个ACK, 它是无法马上返回对方一个FIN报文段的，因为结束数据传输的“指令”是上层应用层给出的，我只是一个“搬运工”，我无法了解“上层的意志”。  

- 讲解的超级详细：[“三次握手，四次挥手”你真的懂吗？](https://zhuanlan.zhihu.com/p/53374516)

### TCP断开连接时的状态转换图
- [socket关闭动作以及socket状态的总结](https://www.cnblogs.com/johnnyflute/p/3536689.html)

## TCP的全连接和半连接队列
- [TCP的全连接和半连接队列](https://zhuanlan.zhihu.com/p/99152064)

## ddos攻击
### TCP三次握手协议和SYN攻击
#### Syn攻击
SYN Flood是互联网上最经典的DDoS攻击方式之一。  

Syn攻击就是客户端 在短时间内伪造大量不存在的IP地址，向服务器不断地发送syn包。服务器回复确认包，并等待客户的确认。由于源地址是不存在的，服务器需要不断的重发直至超时，这些伪造的SYN包将长时间占用半连接队列，正常的SYN请求被丢弃，目标系统运行缓慢，严重者引起网络堵塞甚至系统瘫痪。    


- [TCP三次握手协议和SYN攻击以及DDOS简介](https://blog.csdn.net/shixin_0125/article/details/78829080)

### 什么是ddos攻击
- [深入浅出DDoS攻击](https://www.dell.com/community/%E7%BB%BC%E5%90%88%E8%AE%A8%E8%AE%BA%E5%8C%BA/%E5%88%86%E4%BA%AB-%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BADDoS%E6%94%BB%E5%87%BB%E9%98%B2%E5%BE%A1-%E6%94%BB%E5%87%BB%E7%AF%87/td-p/7002378)

### 如何解决SYN泛洪攻击
- [被骗几十万总结出来的Ddos攻击防护经验！](https://zhuanlan.zhihu.com/p/22953451)
- [服务器遭到SYN攻击怎么办？如何防御SYN攻击？](https://zhuanlan.zhihu.com/p/161807553)
- [TCP SYN flood洪水攻击原理和防御破解](https://www.cnblogs.com/sunsky303/p/11811097.html)
### SYN cookie
- [SYN flood攻击及SYN cookie原理分析](http://p1htmlkernalweb.mybluemix.net/articles/SYN+flood%E6%94%BB%E5%87%BB%E5%8F%8ASYN+cookie%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90_3856229_csdn.html)
- [深入浅出TCP中的SYN-Cookies](https://segmentfault.com/a/1190000019292140)

## 超时重传
- 四次挥手中的TIME_WAIT状态存在的意义（小米，腾讯）
- TIME_WAIT的意义（为什么要等于2MSL）
- tcp三次握手和四次挥手，time_wait状态是怎么回事，一定是出现在客户端吗，为什么是2msl，大量的这种状态会出现什么问题
- 超时重传机制（不太高频）
- TIME_WAIT的作用
- 为什么有TIME_WAIT
- TIME_WAIT状态，如何避免呢，假设现在系统中有很多处于TIME_WAIT的连接，这个时候你会怎么做
- timewait状态
- timewait
- tcp如何设定超时时间
- TIME_WAIT状态持续时间为什么是2MSL，不是1MSL、3MSL
- 快重传

### TIME_WAIT的作用/意义（为什么要等于2MSL）
- [为什么tcp的TIME_WAIT状态要维持2MSL](https://zhuanlan.zhihu.com/p/68040621)

### TIME_WAIT状态/问题，如何解决TIME_WAIT存在的问题？
- [畅谈c/c++ linux下TCP（上）](https://zhuanlan.zhihu.com/p/116751580)

## 滑动窗口和拥塞控制
- 流量控制的介绍，采用滑动窗口会有什么问题（死锁可能，糊涂窗口综合征）？
- Tcp 怎么实现拥塞控制
- tcp滑动窗口协议
- 拥塞控制的流程，窗口大小为什么先以指数增加再以线性增加
- TCP流量控制中发送端和接收端滑动窗口大小是怎么确定的
- 拥塞控制和流量控制的区别
- TCP拥塞控制，算法名字？（极其重要）
- 滑动窗口是什么（腾讯，小米，头条）
- tcp滑动窗口了解吗？那tcp的拥塞控制呢？假设现在网络延迟很高，但是又没有发生丢包，这个时候用tcp进行传输你觉得速率怎么样？
- 流量控制，拥塞控制
- TCP滑动窗口
- TCP流量控制

### 拥塞控制和流量控制的区别
流量控制往往是指在发送端和接收端的点对点通讯量的控制。  

流量控制所要做的就是抑制发送端发送数据的速率，以便使接收端来得及接收。 

而拥塞控制必须确保通讯子网能够传送待传送的数据，是一个全局性的问题，涉及网络中所有的主机、路由器以及导致网络传输能力下降的所有因素。  

### 判断网络是否进入拥塞状态的方法
通过观察网络的吞吐量与网络负载的关系：
- 如果随着网络负载的增加，网络的吞吐量明显小于正常的吞吐量，那么网络就可能进入了“轻度拥塞”状态  
- 如果网络的吞吐量随着网络负载的增大反而下降，网络就可能进入拥塞状态
- 如果网络的负载继续增大，而网络的吞吐量下降到零，网络就可能进入到死锁状态  

为了避免拥塞现象的出现，要采用能防止拥塞的一系列方法对子网进行拥塞控制。  

拥塞控制主要解决的问题是如何获取网络中发生拥塞的信息，从而利用这些信息进行控制，以避免由于拥塞而出现的丢失以及严重拥塞而产生网络死锁的现象。  

## 丢包、粘包、抓包
- 应用层如何保证包有序？粘包了解吗
- tcp粘包
- 发送端连调三次send,接收端收到几个包
- tcpdump抓包，如何分析数据包
- 数据包如何编解码，tcp黏包问题如何解决
- 有没有抓过包
- 有没有抓过TCP包，描述一下
- TCP/IP的分片粘包过程

### 怎么理解tcp一种流式协议
- [TCP是一种流协议](https://michaelyou.github.io/2015/03/24/TCP%E6%98%AF%E4%B8%80%E7%A7%8D%E6%B5%81%E5%8D%8F%E8%AE%AE/)
- [为什么 TCP 协议有粘包问题](https://draveness.me/whys-the-design-tcp-message-frame/)

### tcp粘包的解决方法
- [Socket编程（4）TCP粘包问题及解决方案](https://www.cnblogs.com/QG-whz/p/5537447.html)
- [如何处理Tcp粘包半包问题](https://huchengv5.github.io/post/CTcp%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E7%B2%98%E5%8C%85%E5%8D%8A%E5%8C%85%E9%97%AE%E9%A2%98.html)
- [TCP粘包问题分析和解决（全）](https://blog.csdn.net/tiandijun/article/details/41961785)
- [怎么解决TCP网络传输「粘包」问题？ - amd64的回答 - 知乎](https://www.zhihu.com/question/20210025/answer/1101226017)

### 应用层如何解决粘包问题/应用层如何保证包有序？
你应该在应用层的协议上做点文章，比如增加一个消息头和消息体，消息头中记录了包的序号、长度、包的结束分割符等。这样既能合理分包，同时还能保证包的顺序。  

### 使用tcpdump进行抓包
- [在 Linux 命令行中使用 tcpdump 抓包](https://zhuanlan.zhihu.com/p/48532128)
- [tcpdump/wireshark 抓包及分析（2019）](http://arthurchiao.art/blog/tcpdump-practice-zh/)
