# 线程池

## 面试问题
- 有没有写过线程池？如何实现一个高性能的线程池？你能想到哪些方面？
- 线程池写过吗，讲一讲（腾讯）
- 线程池是怎么实现的
- 线程池的了解、优点、调度处理方式和保护任务队列的方式
- 详细讲解项目中用到的线程池，线程数应该设置为多大

## 问题整理
### 线程池的相关概念：什么是线程池，线程池的优点有哪些..
#### 什么是线程池

一种线程的使用模式，线程过多会带来调度开销，进而影响缓存局部性和整体性能。而线程池维护着多个线程，等待着监督管理者分配可并发执行的任务。这避免了在处理短时间任务时创建与销毁线程的代价。线程池不仅能够保证内核的充分利用，还能防止过分调度。可用线程数量应该取决于可用的并发处理器、处理器内核、内存、网络sockets等的数量。  

在面试上多次被问到，一般的回答都是：管理一个任务队列，一个线程队列，每次取一个任务分配给一个线程去做，循环往复。

这样可以避免反复创建线程对象所带来的性能开销，节省了系统的资源。  

#### 线程池的优点有哪些

使用线程池可以给我们带来很多好处，首先通过线程池中线程的重用，减少创建和销毁线程的性能开销。其次，能控制线程池中的并发数，否则会因为大量的线程争夺CPU资源造成阻塞。最后，线程池能够对线程进行集中管理，线程池可以提供定时、定期、单线程、并发数控制等功能。  

### 实现一个线程池的具体思路

一个简单的线程池的实现思路一般如下： 
- 在ThreadPool中创建多个线程(WorkThreadk对象)，每个线程均处于阻塞状态，等待任务的到来
- ThreadPool提供一个提交任务的接口，如post_job(ProcCallback func, void* data); post_job后会立即返回，不会阻塞
- ThreadPool维护一个空闲线程队列，当客户程序调用post_job()后，如果空闲队列中有空闲线程，则取出一个线程句柄，并设置任务再给出新任务通知事件即可，处理等待的线程捕捉到事件信号后便开始执行任务，执行完后将该线程句柄重新push到空闲线程队列中
- 该线程池采用回调函数方式

### 实现线程池的具体细节：线程数应该设置为多大、调度处理方式和保护任务队列的方式

- [腾讯面试官：线程池要设置多大](https://zhuanlan.zhihu.com/p/116426107)  
- [为什么面试时总会问线程池？](https://www.zhihu.com/question/295692815/answer/498083844)
### 如何实现一个高性能的线程池？你能想到哪些方面？
### 编写线程池
- 实验楼项目
- 实验楼github代码的优化[用 C++ 写线程池是怎样一种体验？](https://www.zhihu.com/question/27908489)
- 主要思路：找一个可读性高的，背一个就好了！

### C++11多线程
- [C++11多线程编程(1)](http://dasheyuan.com/post/cpp-11-multithreading-part-1/)
